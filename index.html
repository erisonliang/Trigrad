<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <link href='http://fonts.googleapis.com/css?family=Merriweather:400,700,300,300italic' rel='stylesheet' type='text/css'>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-46896943-7', 'auto');
        ga('send', 'pageview');

    </script>

    <title>Trigrad by ruarai</title>
</head>

<body>
    <header>
        <div class="inner">
            <h1>Trigrad</h1>
            <h2>Triangle Gradient Image Compression</h2>
        </div>
    </header>

    <div id="content-wrapper">
        <div class="inner clearfix">
            <section id="main-content">
                <h3> What is Trigrad?</h3>

                <p>
                    Trigrad is a (mostly<a href="#footnote-1">[1]</a>) novel image compression algorithm that uses a delaunay triangle mesh and barycentric interpolation to compress.
                    This differs heavily from other compression techniques such as JPEG, which typically use wavelet functions as the basis for their compression.
                </p>

                <h3>How well does it work?</h3>

                <p>Not really well enough to try to push onto people. Current results show that Trigrad can only beat something like JPEG with optimal conditions.</p>

                <h3>How does it look?</h3>

                <p>
                    One of the best tests of a compression algorithm is how its artifacts look. Here's a comparison of a mostly uncompressed image and one compressed with Trigrad, using just 15,000 samples.

                </p>
                <p>
                    <img src="/content_images/comparison.jpg">
                    <i>(Left: Uncompressed. Right: Compressed.)</i>
                </p>

                <p>
                    Of course, with a higher number of samples, a better quality output can be produced. The same image with 25,000 samples starts to look a lot more accurate.
                </p>
                <p>
                    <img src="/content_images/50000.png">
                </p>

                <h3>How does it work?</h3>

                <p>
                    This is where Trigrad gets interesting. Throughout development, I've made sure to produce as many visualizations as I can for the purposes of debugging.
                    This will allow me to explain the process of compression and decompression visually.
                </p>

                <h4>Sampling</h4>

                <img src="/content_images/points.png" alt="">
                <p>
                    Sampling is done through a frequency table that is calculated directly off of the sobel edge detection results of the input image.
                    The frequency table ensures a higher rate of sampling at areas of high areas of change.

                </p>
                <p>
                    <video width="100%" class="gfyVidIframe" id="gfyVid" autoplay loop poster="//thumbs.gfycat.com/GiddyMildIlsamochadegu-poster.jpg" style="-webkit-backface-visibility: hidden; -webkit-transform: scale(1);">
                        <source id="webmsource" src="//zippy.gfycat.com/GiddyMildIlsamochadegu.webm" type="video/webm">
                        <source id="mp4source" src="//fat.gfycat.com/GiddyMildIlsamochadegu.mp4" type="video/mp4">
                        <img src="//giant.gfycat.com/GiddyMildIlsamochadegu.gif" />
                    </video>
                    <i>The effect of changing the sample count. From 1 to 80,000.</i>
                </p>
                <p>
                    The above image, and the one that we will be looking at throughout this post, has had 50,000 samples chosen. This nets an average error of roughly 2.07
                </p>
                <img src="/content_images/data.png" alt="">

                <h4>Further progress</h4>

                <img src="http://i.imgur.com/nzcvlkJ.png" alt="">
                <p>
                    A delaunay mesh is formed from the selected samples.
                    This is achieved using the awesome <a href="https://triangle.codeplex.com/">Triangle.NET</a> port of the equally awesome <a href="http://www.cs.cmu.edu/~quake/triangle.html">Triangle</a> library.
                </p>
                <p>
                    By this point, the mesh could be filled using each pixels <a href="https://github.com/ruarai/Trigrad/blob/master/Trigrad/ColorGraders/BarycentricGrader.cs">Barycentric coordinates</a>.
                    However, in order to achieve optimal results, this mesh is going to have to be tweaked.
                </p>

                <h4>Error Optimisation</h4>
                <p>
                    At first, the end results of this algorithm were rough. Large sample counts were required to produce high quality output, with the delaunay triangulation not conforming to the original data.
                    However, with some simple error minimisation techniques, even a small sample count can yield great results.
                </p>
                <img src="/content_images/errormin.png" alt="">
                <p>
                    The concept of Trigrad's error minimisation is simple. Each vertex of the delaunay mesh is moved to a number of possible points within the surrounding triangle.
                    At each point, the triangles are filled and the error recorded. The point that results in the minimal error is chosen and then the next vertex is tested.
                </p>

                <p>
                    <video width="100%" class="gfyVidIframe" id="gfyVid" autoplay loop poster="//thumbs.gfycat.com/SilentImpishIndianskimmer-poster.jpg" style="-webkit-backface-visibility: hidden;-webkit-transform: scale(1);">
                        <source id="webmsource" src="//zippy.gfycat.com/SilentImpishIndianskimmer.webm" type="video/webm">
                        <source id="mp4source" src="//zippy.gfycat.com/SilentImpishIndianskimmer.mp4" type="video/mp4">
                        <img src="//giant.gfycat.com/SilentImpishIndianskimmer.gif" />
                    </video>
                    <i>One iteration of error minimation in action.</i>

                </p>
                <h4>Compression</h4>
                <p>
                    Once the mesh has been built, it can be saved and zipped up.
                    Our 50,000 sample count mesh can be saved into a file just 600KB in size! This is nice, considering the simplicity of the algorithm.
                </p>
                <img src="/content_images/data2.png" alt="">

                <h4>Other Fill Modes</h4>
                <p>
                    Whilst the barycentric gradient fill mode is obvious and the most precise, there are a number of other interesting modes that can be explored.
                </p>
                <img src="/content_images/trigrader.png" alt="">
                <p>
                    This is after being filled using a solid single colour <a href="https://github.com/ruarai/Trigrad/blob/master/Trigrad/ColorGraders/TriGrader.cs">'trigrader'</a> algorithm.
                    Polygonal!
                </p>
                <img src="/content_images/dithering.png" alt="">
                <p>
                    This is after being filled using an extended <a href="https://github.com/ruarai/Trigrad/blob/master/Trigrad/ColorGraders/TriGrader.cs">dithering</a> algorithm.
                    Kind of like sponge painting.
                </p>
                <h3>
                    Try Trigrad
                </h3>
                <p>
                    Trigrad's source is available online on <a href="https://github.com/ruarai/Trigrad">GitHub</a>.
                </p>
                <h4>Triart (Experimental)</h4>
                <p>
                    If you'd just like to experiment with the various parameters available, an experimental UI is available.
                    This UI does not have compression or decompression support, but it does use the algorithm described above, allowing you to produce unique and impressive results.
                </p>
                <p>
                    <a href="https://dl.dropboxusercontent.com/u/6898485/triart.zip">Download</a>
                </p>
                <img src="/content_images/triart.png" alt="">
                <h3>Further Reading</h3>
                <p>
                    After posting Trigrad v1 to Hacker News, I was alerted to a number of related papers:
                </p>
                <p>
                    <table>
                        <tr>
                            <td>
                                <a href="https://www.cs.cmu.edu/~./garland/scape/scape.pdf">
                                    Fast Polygonal Approximation of
                                    Terrains and Height Fields
                                </a>
                            </td>
                            <td>
                                A similar technique applied to grayscale heightmaps.
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <a href="https://drive.google.com/file/d/0B_Dsm7Bn688EN3ZTQTZqZWF2a3M/view?usp=sharing">
                                    Visual representation by triangulation
                                </a>
                            </td>
                            <td>
                                A similar technique using more comprehensive analysis techniques.
                            </td>
                        </tr>
                    </table>
                </p>
                <h3>
                    Author
                </h3>
                <p>
                    Trigrad was created over a number of holiday weeks. You can check out more work like this on <a href="http://www.ruarai.com">my website.</a>
                </p>
                <h3>
                    Prior Work (Trigrad v1)
                </h3>
                <p>
                    The <a href="old.html">original publication</a> and it's accompanying Hacker News <a href="https://news.ycombinator.com/item?id=9828962">discussion</a>.
                </p>
                <h3>
                    Notes
                </h3>
                <p id="footnote-1">[1] See <a href="#further-reading">further reading</a>.</p>
            </section>
        </div>
    </div>


</body>
</html>
